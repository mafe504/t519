<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seymour Test AI Analyzer</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    
    <!-- Chosen Palette: Academic Calm -->
    <!-- Application Structure Plan: A single-page, vertically scrolling app. 1) 'About' section explains the Seymour Test. 2) 'Form' section prompts the user for their project idea and their answers to the three criteria (Useful, Interconnected, Intuitive). 3) 'Analyze' button triggers the AI. 4) 'Results' section (initially hidden) displays the AI's analysis, broken down by each criterion and an overall assessment. This structure is task-oriented, guiding the user from learning, to inputting, to receiving actionable feedback. -->
    <!-- Visualization & Content Choices: 1. Seymour Test Criteria: Report lists 3 criteria. Goal: Inform. Method: HTML list. Justification: Simple, clear way to present the core concepts. 2. User Input: User has a project idea. Goal: Collect Data. Method: HTML form with textreas. Justification: Standard way to collect multi-line text input for analysis. 3. AI Analysis: User wants feedback. Goal: Analyze & Inform. Method: Call Gemini-2.5-Flash with a JSON schema to get structured feedback. The results are displayed in styled HTML cards (one for each criterion + summary). Justification: This is the core "wow" factor. Instead of a simple text dump, the JSON schema ensures the AI provides specific feedback for each part of the test, which we can then render in a clean, easy-to-read, card-based layout. The 'passed' boolean will dynamically color-code the results (green/orange). -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        html {
            scroll-behavior: smooth;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: #0369a1; /* sky-700 */
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        stone: {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            300: '#d6d3d1',
                            600: '#57534e',
                            800: '#292524',
                        },
                        sky: {
                            100: '#e0f2fe',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e',
                        },
                        green: {
                            100: '#dcfce7',
                            600: '#16a34a',
                            700: '#15803d',
                        },
                        orange: {
                            100: '#fff7ed',
                            600: '#ea580c',
                            700: '#c2410c',
                        }
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                        'pulse-button': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: 0, transform: 'translateY(20px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' }
                        },
                        pulse: {
                            '0%, 100%': { opacity: 1, shadow: '0 0 0 0 rgba(3, 105, 161, 0.4)' },
                            '50%': { opacity: .9, shadow: '0 0 0 10px rgba(3, 105, 161, 0)' }
                        }
                    }
                }
            },
            plugins: [
                // require('@tailwindcss/forms'), // This was causing the error
            ],
        }
    </script>
</head>
<body class="bg-gradient-to-br from-white to-stone-100 text-stone-800 font-sans antialiased">

    <div class="container mx-auto max-w-3xl p-6 md:p-10 space-y-10">

        <header class="text-center space-y-3">
            <h1 class="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-sky-600 to-sky-800 py-2">Seymour Test AI Analyzer</h1>
            <p class="text-xl text-stone-600">Test your project idea against Papert's "Powerful Ideas" framework.</p>
        </header>

        <section id="about" class="bg-white p-8 rounded-xl shadow-lg border border-stone-200 transition-all duration-300 ease-in-out hover:scale-[1.02] hover:shadow-xl">
            <h2 class="text-2xl font-semibold text-sky-900 mb-4">What is the "Seymour Test"?</h2>
            <p class="text-stone-600 mb-4">
                Based on the work of Seymour Papert and Marina Umaschi Bers, the "Seymour Test" evaluates an educational project by determining if it helps children learn a <strong class="text-sky-700">"Powerful Idea."</strong>
            </p>
            <p class="text-stone-600 mb-4">A Powerful Idea isn't just a fact; it's a concept that changes how a child thinks. To pass the test, your project's main idea must meet three criteria:</p>
            <ul class="list-decimal list-inside space-y-2 text-stone-700">
                <li><strong class="font-semibold">Personally Useful:</strong> Does it empower the child with new ways to think or act?</li>
                <li><strong class="font-semibold">Epistemologically Interconnected:</strong> Does it connect to other domains of knowledge (math, science, art, etc.)?</li>
                <li><strong class="font-semibold">Roots in Intuitive Knowledge:</strong> Does it build upon what the child already intuitively understands?</li>
            </ul>
        </section>

        <section id="form" class="bg-white p-8 rounded-xl shadow-lg border border-stone-200 transition-all duration-300 ease-in-out hover:scale-[1.02] hover:shadow-xl">
            <h2 class="text-2xl font-semibold text-sky-900 mb-6">Does my project pass the Seymour Test?</h2>
            <form id="test-form" class="space-y-6">
                <div>
                    <label for="project-description" class="block text-sm font-medium text-stone-700 mb-1">1. What is your project idea?</label>
                    <textarea id="project-description" rows="3" class="w-full rounded-lg border-stone-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 focus:scale-[1.02] transition-all duration-300" placeholder="e.g., A project where students design and 3D print custom keychains with their initials."></textarea>
                </div>

                <div>
                    <label for="powerful-idea" class="block text-sm font-medium text-stone-700 mb-1">2. What is the *main Powerful Idea* your project teaches?</label>
                    <input type="text" id="powerful-idea" class="w-full rounded-lg border-stone-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 focus:scale-[1.02] transition-all duration-300" placeholder="e.g., Parametric design (the idea that one design can generate many variations).">
                </div>
                
                <hr class="border-stone-200">

                <div>
                    <label for="criteria-useful" class="block text-sm font-medium text-stone-700 mb-1">3. How is this idea <strong class="text-sky-700">Personally Useful</strong> to the child?</label>
                    <textarea id="criteria-useful" rows="3" class="w-full rounded-lg border-stone-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 focus:scale-[1.02] transition-all duration-300" placeholder="e.g., They can use this idea to quickly customize other 3D models, or understand how products are personalized..."></textarea>
                </div>
                
                <div>
                    <label for="criteria-interconnected" class="block text-sm font-medium text-stone-700 mb-1">4. How is this idea <strong class="text-sky-700">Interconnected</strong> with other knowledge?</label>
                    <textarea id="criteria-interconnected" rows="3" class="w-full rounded-lg border-stone-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 focus:scale-[1.02] transition-all duration-300" placeholder="e.g., It connects to math (variables, functions), design (aesthetics), and manufacturing (prototyping)..."></textarea>
                </div>

                <div>
                    <label for="criteria-intuitive" class="block text-sm font-medium text-stone-700 mb-1">5. How does this idea build on the child's <strong class="text-sky-700">Intuitive Knowledge</strong>?</label>
                    <textarea id="criteria-intuitive" rows="3" class="w-full rounded-lg border-stone-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 focus:scale-[1.02] transition-all duration-300" placeholder="e.g., Kids already know about 'find and replace' in text, or 'filters' on photos. This extends that idea to physical objects..."></textarea>
                </div>

                <button type="submit" id="analyze-button" class="w-full px-6 py-3 rounded-lg text-white font-semibold shadow-md transition-all duration-300 bg-sky-600 hover:bg-sky-700 hover:shadow-lg transform hover:-translate-y-1 animate-pulse-button">
                    Analyze My Idea
                </button>
            </form>
        </section>

        <section id="results" class="hidden">
            <h2 class="text-3xl font-bold text-center text-sky-700 mb-6">AI Analysis Results</h2>
            
            <div id="results-loading" class="text-center p-8 bg-white rounded-xl shadow-lg">
                <div class="loader mx-auto"></div>
                <p class="text-stone-600 mt-4 text-lg">Analyzing your idea... this may take a moment.</p>
            </div>

            <div id="results-content" class="hidden space-y-8">
                <div id="overall-card" class="p-6 rounded-xl shadow-lg opacity-0">
                    <h3 class="text-2xl font-semibold mb-3 flex items-center">
                        <span id="overall-icon" class="mr-3"></span>
                        <span id="overall-title"></span>
                    </h3>
                    <p id="overall-assessment" class="text-lg"></p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div id="useful-card" class="opacity-0 p-6 bg-white rounded-xl shadow-lg border-t-4">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-xl font-semibold text-sky-900">1. Personally Useful</h4>
                            <span id="useful-badge" class="text-xs font-bold px-3 py-1 rounded-full"></span>
                        </div>
                        <p id="useful-analysis" class="text-stone-700"></p>
                    </div>
                    <div id="interconnected-card" class="opacity-0 p-6 bg-white rounded-xl shadow-lg border-t-4">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-xl font-semibold text-sky-900">2. Interconnected</h4>
                            <span id="interconnected-badge" class="text-xs font-bold px-3 py-1 rounded-full"></span>
                        </div>
                        <p id="interconnected-analysis" class="text-stone-700"></p>
                    </div>
                    <div id="intuitive-card" class="opacity-0 p-6 bg-white rounded-xl shadow-lg border-t-4">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-xl font-semibold text-sky-900">3. Intuitive</h4>
                            <span id="intuitive-badge" class="text-xs font-bold px-3 py-1 rounded-full"></span>
                        </div>
                        <p id="intuitive-analysis" class="text-stone-700"></p>
                    </div>
                </div>
            </div>

        </section>

    </div>

    <div id="disclaimer-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-lg w-full mx-4 transform transition-all duration-300 scale-95" id="modal-panel">
            <h3 class="text-xl font-semibold text-sky-900 mb-4">Disclaimer</h3>
            <p class="text-stone-600 mb-6">
                This tool is powered by an LLM AI. The analysis provided may not always be correct or complete. You are using this tool at your own risk, for educational purposes only.
                <br><br>
                - Musa
            </p>
            <div class="flex justify-end space-x-4">
                <button id="modal-cancel" class="px-5 py-2 rounded-lg text-stone-700 bg-stone-100 hover:bg-stone-200 transition-colors font-medium">Cancel</button>
                <button id="modal-continue" class="px-5 py-2 rounded-lg text-white bg-sky-600 hover:bg-sky-700 transition-colors font-medium">I Understand, Continue</button>
            </div>
        </div>
    </div>

    <footer class="text-center py-10 border-t border-stone-200 mt-10 space-y-2">
        <p class="text-sm text-stone-500">This tool was developed by Musa Abu Hadeed for the t519 class (Fall '25) at Harvard University.</p>
        <p class="text-xs text-stone-400">Powered by AI. Based on the "Powerful Ideas" framework of Seymour Papert and Marina Umaschi Bers.</p>
    </footer>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('test-form');
            const button = document.getElementById('analyze-button');
            const resultsSection = document.getElementById('results');
            const resultsLoading = document.getElementById('results-loading');
            const resultsContent = document.getElementById('results-content');
            
            const modal = document.getElementById('disclaimer-modal');
            const modalPanel = document.getElementById('modal-panel');
            const modalCancel = document.getElementById('modal-cancel');
            const modalContinue = document.getElementById('modal-continue');
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                // Show the modal instead of analyzing immediately
                modal.classList.remove('hidden');
                modal.classList.remove('opacity-0');
                modalPanel.classList.remove('scale-95');
            });

            modalCancel.addEventListener('click', () => {
                modalPanel.classList.add('scale-95');
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            });

            modalContinue.addEventListener('click', () => {
                modalPanel.classList.add('scale-95');
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
                handleAnalyzeClick(); // Proceed with analysis
            });

            async function handleAnalyzeClick() {
                button.disabled = true;
                button.textContent = 'Analyzing...';
                resultsSection.classList.remove('hidden');
                resultsLoading.classList.remove('hidden');
                resultsContent.classList.add('hidden');

                // Reset card styles for re-analysis
                document.getElementById('overall-card').className = 'p-6 rounded-xl shadow-lg opacity-0';
                document.getElementById('useful-card').className = 'opacity-0 p-6 bg-white rounded-xl shadow-lg border-t-4';
                document.getElementById('interconnected-card').className = 'opacity-0 p-6 bg-white rounded-xl shadow-lg border-t-4';
                document.getElementById('intuitive-card').className = 'opacity-0 p-6 bg-white rounded-xl shadow-lg border-t-4';


                const projectDescription = document.getElementById('project-description').value;
                const powerfulIdea = document.getElementById('powerful-idea').value;
                const usefulAnswer = document.getElementById('criteria-useful').value;
                const interconnectedAnswer = document.getElementById('criteria-interconnected').value;
                const intuitiveAnswer = document.getElementById('criteria-intuitive').value;

                const systemPrompt = `You are an expert in Seymour Papert's "Constructionism" and educational technology, acting as an AI analyzer. Your task is to analyze a user's project idea against the three criteria of a "Powerful Idea" from Papert's work, as described by Marina Umaschi Bers:
1.  **Personally Useful:** Does the idea empower the child with new ways to think or act?
2.  **Epistemologically Interconnected:** Does it connect to other domains of knowledge (math, science, art, etc.)?
3.  **Roots in Intuitive Knowledge:** Does it build upon what the child already intuitively understands about the world?

You must evaluate the user's justification for each criterion and provide constructive feedback. Respond *only* in the provided JSON schema. Be encouraging but honest. If a justification is weak, explain why and suggest how to strengthen it.`;

                const userQuery = `Please analyze my project based on the three criteria.

Project: ${projectDescription}
Powerful Idea: ${powerfulIdea}

1.  My justification for "Personally Useful":
    ${usefulAnswer}

2.  My justification for "Interconnected":
    ${interconnectedAnswer}

3.  My justification for "Intuitive":
    ${intuitiveAnswer}`;

                const schema = {
                    "type": "OBJECT",
                    "properties": {
                        "usefulAnalysis": {
                            "type": "STRING",
                            "description": "Your analysis of the 'Personally Useful' criterion based on the user's justification. Start with 'Pass:' or 'Needs Work:' and explain your reasoning."
                        },
                        "interconnectedAnalysis": {
                            "type": "STRING",
                            "description": "Your analysis of the 'Interconnected' criterion. Start with 'Pass:' or 'Needs Work:' and explain."
                        },
                        "intuitiveAnalysis": {
                            "type": "STRING",
                            "description": "Your analysis of the 'Intuitive' criterion. Start with 'Pass:' or 'Needs Work:' and explain."
                        },
                        "overallAssessment": {
                            "type": "STRING",
                            "description": "A final summary (2-3 sentences) with an overall judgment ('This project clearly passes...' or 'This is a good start, but needs modification...') and actionable advice."
                        },
                        "passed": {
                            "type": "BOOLEAN",
                            "description": "True if all 3 criteria are strong, false otherwise."
                        }
                    },
                    "required": ["usefulAnalysis", "interconnectedAnalysis", "intuitiveAnalysis", "overallAssessment", "passed"]
                };

                try {
                        // pass the collected answers to allow local demo/mock mode when no API key is set
                        const parsedJson = await fetchWithBackoff(systemPrompt, userQuery, schema, 3, {
                            projectDescription,
                            powerfulIdea,
                            usefulAnswer,
                            interconnectedAnswer,
                            intuitiveAnswer
                        });
                    displayResults(parsedJson);
                } catch (error) {
                    console.error(error);
                    resultsLoading.innerHTML = `<p class="text-red-600">An error occurred. Please try again.</p>`;
                } finally {
                    button.disabled = false;
                    button.textContent = 'Analyze My Idea';
                    resultsLoading.classList.add('hidden');
                    resultsContent.classList.remove('hidden');
                }
            }

            function displayResults(data) {
                const overallCard = document.getElementById('overall-card');
                const overallIcon = document.getElementById('overall-icon');
                const overallTitle = document.getElementById('overall-title');
                const overallAssessment = document.getElementById('overall-assessment');
                
                overallAssessment.textContent = data.overallAssessment;
                
                if (data.passed) {
                    overallCard.classList.add('bg-green-100', 'border-green-600');
                    overallIcon.textContent = 'âœ…';
                    overallTitle.textContent = 'Passes the Test!';
                    overallTitle.classList.add('text-green-700');
                } else {
                    overallCard.classList.add('bg-orange-100', 'border-orange-600');
                    overallIcon.textContent = 'ðŸ’¡';
                    overallTitle.textContent = 'Needs Modification';
                    overallTitle.classList.add('text-orange-700');
                }

                // Staggered animation
                setTimeout(() => {
                    overallCard.classList.remove('opacity-0');
                    overallCard.classList.add('animate-fade-in-up');
                }, 0);

                const usefulCard = document.getElementById('useful-card');
                const interconnectedCard = document.getElementById('interconnected-card');
                const intuitiveCard = document.getElementById('intuitive-card');

                setTimeout(() => {
                    styleResultCard(usefulCard, data.usefulAnalysis, 'useful');
                    usefulCard.classList.remove('opacity-0');
                    usefulCard.classList.add('animate-fade-in-up');
                }, 200);

                setTimeout(() => {
                    styleResultCard(interconnectedCard, data.interconnectedAnalysis, 'interconnected');
                    interconnectedCard.classList.remove('opacity-0');
                    interconnectedCard.classList.add('animate-fade-in-up');
                }, 400);

                setTimeout(() => {
                    styleResultCard(intuitiveCard, data.intuitiveAnalysis, 'intuitive');
                    intuitiveCard.classList.remove('opacity-0');
                    intuitiveCard.classList.add('animate-fade-in-up');
                }, 600);
            }

            function styleResultCard(cardElement, analysisText, idPrefix) {
                const badge = document.getElementById(`${idPrefix}-badge`);
                const analysisP = document.getElementById(`${idPrefix}-analysis`);

                analysisP.textContent = analysisText.substring(analysisText.indexOf(':') + 1).trim();
                
                if (analysisText.toLowerCase().startsWith('pass:')) {
                    cardElement.classList.add('border-green-600');
                    badge.textContent = 'Pass';
                    badge.classList.add('bg-green-100', 'text-green-700');
                } else {
                    cardElement.classList.add('border-orange-600');
                    badge.textContent = 'Needs Work';
                    badge.classList.add('bg-orange-100', 'text-orange-700');
                }
            }

            function generateMockResponse(inputs = {}, schema) {
                // Simple client-side heuristic analyzer for demo/public mode.
                const useful = (inputs.usefulAnswer || '').trim();
                const interconnected = (inputs.interconnectedAnswer || '').trim();
                const intuitive = (inputs.intuitiveAnswer || '').trim();

                function assess(text, label) {
                    if (!text || text.length < 40) {
                        return {
                            text: `Needs Work: The ${label} justification is short or missing. Give a concrete example, explicitly connect it to learning outcomes, and explain why it's useful for a child.`,
                            pass: false
                        };
                    }

                    // simple keyword boost
                    const keywords = ['example', 'children', 'learn', 'understand', 'apply', 'connect', 'practice', 'explore'];
                    const hasKeyword = keywords.some(k => text.toLowerCase().includes(k));

                    return {
                        text: `Pass: Solid justification.${hasKeyword ? ' Nice use of concrete language.' : ''} Consider adding a short example to make it even stronger.`,
                        pass: true
                    };
                }

                const a1 = assess(useful, 'Personally Useful');
                const a2 = assess(interconnected, 'Interconnected');
                const a3 = assess(intuitive, 'Intuitive');

                const passed = a1.pass && a2.pass && a3.pass;
                const overall = passed
                    ? 'This project clearly passes the Seymour Test. Good job â€” add one brief example per criterion to make the case even stronger.'
                    : 'This is a good start but needs more concrete justification in one or more criteria. Expand the weaker answers with examples or explicit connections to other domains.';

                return {
                    usefulAnalysis: a1.text,
                    interconnectedAnalysis: a2.text,
                    intuitiveAnalysis: a3.text,
                    overallAssessment: overall,
                    passed
                };
            }

            async function fetchWithBackoff(systemPrompt, userQuery, schema, maxRetries = 3, inputs = null) {
                // If no API key is provided, run a safe local demo (no secrets exposed).
                const apiKey = "";
                if (!apiKey || apiKey.trim() === '') {
                    try {
                        // show a small demo-mode note to users
                        if (resultsLoading) {
                            const note = document.createElement('p');
                            note.className = 'text-sm text-stone-500 mt-3';
                            note.textContent = 'Running in demo mode â€” analysis is generated locally for demonstration. To use a real model, deploy a server proxy with your API key.';
                            resultsLoading.appendChild(note);
                        }
                        // generate a deterministic mock response based on the user's inputs
                        return generateMockResponse(inputs || {}, schema);
                    } catch (e) {
                        throw new Error('Demo analysis failed: ' + e.message);
                    }
                }

                // Real API path (kept as before). Uses exponential backoff on errors.
                let delay = 1000;
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                        const payload = {
                            contents: [{ parts: [{ text: userQuery }] }],
                            systemInstruction: {
                                parts: [{ text: systemPrompt }]
                            },
                            generationConfig: {
                                responseMimeType: "application/json",
                                responseSchema: schema,
                                temperature: 0.3
                            }
                        };

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {

                            const jsonText = result.candidates[0].content.parts[0].text;
                            return JSON.parse(jsonText);
                        } else {
                            throw new Error('Invalid AI response structure');
                        }

                    } catch (error) {
                        if (i === maxRetries - 1) throw error;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    }
                }
            }
        });
    </script>
</body>
</html>
